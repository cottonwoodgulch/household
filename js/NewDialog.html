{*<!-- dialog box for looking up either a household (buttonAction = "selectHouse", "moveMember")
    or a contact ("addMember")
  -->*}
  
  <div id="LookupDialog" style="display: none">
  <h3 id="LookupInfo"></h3>
  <form method="post" id="LookupForm">
    <input type="hidden" name="TargetHouseID" id="TargetHouseID">
    <input type="hidden" name="CurrentHouseID" id="CurrentHouseID">
    <input type="hidden" name="ContactID" id="ContactID">
    <input type="hidden" name="ContactName" id="ContactName">
    <input type="hidden" name="buttonAction" value="">
    <table class="edit">
    {if buttonAction != "addMember"}
      <tr>
        <td class="label" id="LookupByName">by Household Name</td>
        <td>
          <input id="NameLookup">
        </td>
      </tr>
      <tr><td>&nbsp;</td></tr>
    {/if}
      <tr>
        <td class="label">by a Member's Name</td>
        <td><input id="MemberLookup"></td>
      </tr>
    </table>
  </form>
  </div>
  
  {literal}<script>

  function addMember(target_household_id, form_action){
    $("#TargetHouseID").val(target_household_id);
    lookup('Add a member to this household', form_action, "addMember");
  }

  function moveMember(selected_contact_id, selected_contact_name, form_action){
    $("#ContactID").val(selected_contact_id);
    $("#ContactName").val(selected_contact_name);
    lookup('Select another household to place '+selected_contact_name,
        form_action, 'moveMember');
  }

  /* the literal tags are because the braces in javascript confuse smarty */
  function lookup(title,form_action,buttonAction) {
    $("#LookupForm input[name=buttonAction]").val(buttonAction);
    $("#LookupDialog").dialog ({
      height: "auto",
      width: "auto",
      modal: true,
      classes: {"ui-dialog": "no-titlebar"},
      closeOnEscape: true,
      /* title: title, */
      buttons: [
        {
          text: "Cancel",
          click: function() {
            $("#NameLookup").val("");
            $("#NameLookup").autocomplete("destroy");
            $("#MemberLookup").val("");
            $("#MemberLookup").autocomplete("destroy");
            $(this).dialog("destroy");
          }
        }
      ]
    });
    $("#LookupForm").attr("action",form_action);
    $("#LookupInfo").html(title);
    $("#NameLookup").autocomplete({
      minLength: 3,
      source: function(request, response) {
        $.ajax({
          type: "GET",
          url: "ajax/NameLookup.php?value="+$("#NameLookup").val(),
          dataType: "json",
          success: function(res_html, textStatus, xhr) {
            response(res_html);
          },
          error: function(xhr, textStatus, errorThrown) {
            $("#content").html(textStatus+errorThrown);
          }
        })
      },
      select: function(event, ui) {
        //$("#SelectedHouseID").val($("#NameLookup").val());
        $("#SelectedHouseID").val(ui.item.value);
        if (buttonAction=="moveMember") {
          var confmsg = "Move "+$("#SelectedContactName").val()+" to "+ui.item.housename+" household";
          Confirm(buttonAction, confmsg, "#LookupForm");
        } else { // buttonAction = "selectHouse" 
          $("#LookupForm").submit();
        }
      }
    });
    $("#MemberLookup").autocomplete({
      minLength: 3,
      source: function(request, response) {
        $.ajax({
          type: "GET",
          url: "ajax/MemberLookup.php?value="+$("#MemberLookup").val(),
          dataType: "json",
          success: function(res_html, textStatus, xhr) {
            response(res_html);
          },
          error: function(xhr, textStatus, errorThrown) {
            $("#content").html(textStatus+errorThrown);
          }
        })
      },
      select: function(event, ui) {
        $("#SelectedHouseID").val(ui.item.value);
        if (buttonAction=="moveMember") {
          var confmsg = "Move "+$("#SelectedContactName").val()+" to "+ui.item.housename+" household";
          Confirm(buttonAction, confmsg, "#LookupForm");
        } else { // buttonAction = "selectHouse" 
          $("#LookupForm").submit();
        }
      }
    });
  }
  </script>{/literal}
  